{% extends "main/base.html" %}

{% block title %}Monthly Calendar{% endblock %}

{% block content %}
  <h2>Your Monthly Schedule</h2>

  <!-- =========================
       Monthly Navigation
       ========================= -->
  <div class="calendar-nav">
    <a class="btn btn-soft"
       href="{% url 'calendar_monthly' %}?year={{ prev_year }}&month={{ prev_month }}">← Previous Month</a>

    <a class="btn btn-soft"
       href="{% url 'calendar_monthly' %}?year={{ next_year }}&month={{ next_month }}">Next Month →</a>

    <!-- Jump to weekly for the first day of this month -->
    <a class="btn btn-outline"
       href="{% url 'calendar_weekly' %}?start={{ year }}-{{ month|stringformat:'02d' }}-01">Weekly View</a>
  </div>

  <section class="dash-card monthlyCalendar">
    <h3>{{ month_name }} {{ year }}</h3>

    <div class="calendar-wrapper">
      <table class="calendar-table">
        <thead>
          <tr>
            <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
          </tr>
        </thead>

        <tbody>
          {% for week in month_rows %}
            <tr>
              {% for cell in week %}
                <td class="{% if not cell.day %}muted-cell{% endif %}">
                  {% if cell.day %}
                    <div class="day-number">{{ cell.day }}</div>

                    {% if cell.items %}
                      {% for item in cell.items %}

                        {# CLICKABLE EVENT: opens detail page, returns back to this month #}
                        <a class="event-link"
                           href="{% url 'schedule_detail' item.pk %}?next={{ request.get_full_path|urlencode }}">
                          <div class="event">
                            <strong>{{ item.time|time:"H:i" }}</strong> {{ item.title }}
                            <span class="pill">{{ item.get_item_type_display }}</span>
                          </div>
                        </a>

                      {% endfor %}
                    {% endif %}
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>

    <p class="table-footer">
      <a href="{% url 'dashboard' %}">Back to Dashboard</a>
    </p>
  </section>
{% endblock %}
