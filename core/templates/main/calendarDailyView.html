{% extends "main/base.html" %}

{% block title %}Daily Calendar{% endblock %}

{% block content %}
  <h2>Your Daily Schedule</h2>

  <!-- =========================
       Top Navigation (Daily + jump to Week/Month)
       ========================= -->
  <div class="calendar-nav">
    <!-- Prev/Next Day -->
    <a class="btn btn-soft" href="?date={{ prev_date|date:'Y-m-d' }}">← Previous Day</a>
    <a class="btn btn-soft" href="?date={{ next_date|date:'Y-m-d' }}">Next Day →</a>

    <!-- Jump to weekly/monthly for the same time period -->
    <a class="btn btn-outline" href="{% url 'calendar_weekly' %}?start={{ week_start|date:'Y-m-d' }}">Weekly View</a>
    <a class="btn btn-outline" href="{% url 'calendar_monthly' %}?year={{ chosen_date|date:'Y' }}&month={{ chosen_date|date:'n' }}">Monthly View</a>
  </div>

  <!-- Date Picker -->
  <form method="get" class="inline-form">
    <label for="date">Choose a date:</label>
    <input type="date" id="date" name="date" value="{{ chosen_date|date:'Y-m-d' }}">
    <button class="btn btn-soft" type="submit">Go</button>
  </form>

  <section class="dash-card dailyCalendarDate">
    <h3>Date</h3>
    <p id="current-date">{{ chosen_date|date:"l, F j, Y" }}</p>
  </section>

  <section class="dash-card dailyCalendar">
    <h3>Time Slots</h3>

    <div class="calendar-wrapper">
      <table class="calendar-table daily">
        <thead>
          <tr>
            <th>Time</th>
            <th>Event</th>
          </tr>
        </thead>

        <tbody>
          {% for row in rows %}
            <tr>
              <td class="time-col">
                {{ row.hour }}:00 – {{ row.hour|add:"1" }}:00
              </td>

              <td id="hour-{{ row.hour }}">
                {% if row.items %}
                  {% for item in row.items %}

                    {# CLICKABLE EVENT: opens detail page, and returns back here #}
                    <a class="event-link"
                       href="{% url 'schedule_detail' item.pk %}?next={{ request.get_full_path|urlencode }}">
                      <div class="event">
                        <strong>{{ item.title }}</strong>
                        <span class="pill">{{ item.get_item_type_display }}</span>
                        <div class="muted">{{ item.time|time:"H:i" }} ({{ item.duration_minutes }} min)</div>
                        {% if item.notes %}
                          <div class="muted">{{ item.notes }}</div>
                        {% endif %}
                      </div>
                    </a>

                  {% endfor %}
                {% else %}
                  <span class="muted">—</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>

    <p class="table-footer">
      <a href="{% url 'dashboard' %}">Back to Dashboard</a>
    </p>
  </section>
{% endblock %}
